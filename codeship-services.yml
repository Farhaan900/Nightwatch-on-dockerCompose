chrome:
  image: selenium/node-chrome:3.0.1
  environment: &SELENIUM_NODE_ENV
    # this is a necessary workaround due to a known bug
    # https://github.com/SeleniumHQ/docker-selenium/issues/133
    HUB_PORT_4444_TCP_ADDR: hub
    HUB_PORT_4444_TCP_PORT: 4444
  depends_on:
    - hub

firefox:
  image: selenium/node-firefox:3.0.1
  environment:
    <<: *SELENIUM_NODE_ENV
  depends_on:
    - hub

hub:
  image: selenium/hub:3.0.1
  environment:
    GRID_BROWSER_TIMEOUT: 120000
    GRID_NEW_SESSION_WAIT_TIMEOUT: 20000
    GRID_NODE_POLLING: 300
    GRID_TIMEOUT: 120000
  ports:
    - "4444"

nightwatch:
  build: .
  environment:
    NODE_ENV: test
  depends_on:
    - chrome
    - firefox
    - hub
    - web

web:
  image: mycargus/hello_docker_world:latest
